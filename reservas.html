<!DOCTYPE html>
<html lang="pt-BR">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Reservas • Grupo DV</title>

<style>
body{
    margin:0;
    background:#f4f5f7;
    font-family:Arial, sans-serif;
}

/* HEADER */
.header{
    background:white;
    padding:18px 20px;
    font-size:22px;
    font-weight:700;
    border-bottom:1px solid #ddd;
}

/* CALENDÁRIO */
.calendar{
    padding:20px;
}

.month-row{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:14px;
}

.month-btn{
    background:none;
    border:none;
    font-size:22px;
    cursor:pointer;
}

.month-name{
    font-size:20px;
    font-weight:700;
}

.week{
    display:grid;
    grid-template-columns: repeat(7, 1fr);
    text-align:center;
    margin-bottom:6px;
    font-weight:bold;
}

.days{
    display:grid;
    grid-template-columns: repeat(7, 1fr);
    gap:6px;
}

.day{
    background:white;
    padding:12px;
    border-radius:10px;
    min-height:60px;
    cursor:pointer;
    box-shadow:0 1px 2px rgba(0,0,0,.1);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
}

.day:hover{
    background:#eaf3ff;
}

.day-number{
    font-size:16px;
    font-weight:700;
}

/* Badges */
.badge{
    margin-top:6px;
    font-size:12px;
    padding:4px 7px;
    border-radius:8px;
    font-weight:700;
    color:white;
}

.badge-pago{ background:#28a745; }
.badge-pendente{ background:#dc3545; }
.badge-andamento{ background:#ffc107; }

/* RESUMO FINANCEIRO */
.resumo{
    background:white;
    margin:20px;
    padding:18px;
    border-radius:14px;
    box-shadow:0 2px 6px rgba(0,0,0,.1);
}

.resumo h3{
    margin-top:0;
    font-size:20px;
    font-weight:700;
}

.row{
    display:flex;
    justify-content:space-between;
    padding:6px 0;
}

.valor{
    font-weight:700;
}

.v-green{ color:#28a745; }
.v-red{ color:#dc3545; }
.v-blue{ color:#007bff; }
</style>
</head>

<body>

<div class="header">Reservas</div>

<div class="calendar">

    <div class="month-row">
        <button class="month-btn" onclick="mudarMes(-1)">◀</button>
        <div id="mesAno" class="month-name"></div>
        <button class="month-btn" onclick="mudarMes(1)">▶</button>
    </div>

    <div class="week">
        <div>Dom</div><div>Seg</div><div>Ter</div>
        <div>Qua</div><div>Qui</div><div>Sex</div><div>Sáb</div>
    </div>

    <div id="dias" class="days"></div>
</div>

<div class="resumo">
    <h3>Resumo do Mês</h3>

    <div class="row">
        <span>Total Recebido</span>
        <span id="rRecebido" class="valor v-green">R$ 0,00</span>
    </div>

    <div class="row">
        <span>Total Pendente</span>
        <span id="rPendente" class="valor v-red">R$ 0,00</span>
    </div>

    <div class="row">
        <span>Total em Andamento</span>
        <span id="rAndamento" class="valor v-blue">R$ 0,00</span>
    </div>
</div>

<script>
/* ================================
   CONFIGURAÇÕES
================================ */
const ENDPOINT = "https://script.google.com/macros/s/AKfycbwE-0oOl4wGHz7gFXHIgYHNihCTW4-uzUjGv_iLvPSWX1sma8pi9eJIwx1K4grFOILj/exec";

let hoje = new Date();
let mesAtual = hoje.getMonth();
let anoAtual = hoje.getFullYear();

/* ================================
   MONTAR CALENDÁRIO
================================ */
function montarCalendario(){

    document.getElementById("mesAno").textContent =
        hoje.toLocaleDateString("pt-BR",{ month:"long", year:"numeric" });

    const firstDay = new Date(anoAtual, mesAtual, 1).getDay();
    const lastDate = new Date(anoAtual, mesAtual+1, 0).getDate();

    const diasBox = document.getElementById("dias");
    diasBox.innerHTML = "";

    for(let i=0;i<firstDay;i++){
        diasBox.innerHTML += `<div></div>`;
    }

    for(let dia=1; dia<=lastDate; dia++){
        diasBox.innerHTML += `
            <div class="day" onclick="abrirDia(${dia})">
                <div class="day-number">${dia}</div>
                <div id="badge_${dia}"></div>
            </div>
        `;
    }

    carregarContadoresDoMes();
}

/* ================================
   MUDAR MÊS
================================ */
function mudarMes(delta){
    mesAtual += delta;
    if(mesAtual < 0){ mesAtual = 11; anoAtual--; }
    if(mesAtual > 11){ mesAtual = 0; anoAtual++; }

    hoje = new Date(anoAtual, mesAtual, 1);
    montarCalendario();
}

/* ================================
   ABRIR CADASTRO EXTERNO
================================ */
function abrirDia(dia){
    const data = `${anoAtual}-${String(mesAtual+1).padStart(2,'0')}-${String(dia).padStart(2,'0')}`;
    window.location.href = `cadastro.html?data=${data}`;
}

/* ================================
   BUSCAR RESUMO FINANCEIRO + BADGES
================================ */
async function carregarContadoresDoMes(){
    const r = await fetch(`${ENDPOINT}?acao=resumoMes&mes=${mesAtual+1}&ano=${anoAtual}`);
    const dados = await r.json();

    document.getElementById("rRecebido").textContent = "R$ " + dados.recebido;
    document.getElementById("rPendente").textContent = "R$ " + dados.pendente;
    document.getElementById("rAndamento").textContent = "R$ " + dados.andamento;

    dados.dias.forEach(d=>{
        const badge = document.getElementById("badge_"+d.dia);

        if(!badge) return;

        if(d.pendente>0){
            badge.innerHTML += `<div class="badge badge-pendente">${d.pendente}</div>`;
        }
        if(d.andamento>0){
            badge.innerHTML += `<div class="badge badge-andamento">${d.andamento}</div>`;
        }
        if(d.pago>0){
            badge.innerHTML += `<div class="badge badge-pago">${d.pago}</div>`;
        }
    });
}

montarCalendario();
</script>

</body>
</html>
