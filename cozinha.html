<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Cozinha – Tarefas</title>

<style>
body {
    margin: 0;
    background: #e5ddd5;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    padding-bottom: calc(80px + env(safe-area-inset-bottom));
}

/* TOPO */
.header {
    height: calc(60px + env(safe-area-inset-top));
    padding-top: calc(10px + env(safe-area-inset-top));
    padding-left: 18px;
    display: flex;
    align-items: center;
    font-size: 20px;
    font-weight: 700;
    background: #ffffff;
    border-bottom: 1px solid #ddd;
}

/* ÁREA DAS MENSAGENS */
.chat-area {
    padding: 18px;
}

/* BOLHA DO SISTEMA (tarefa) */
.msg {
    background: #ffffff;
    padding: 14px 16px;
    border-radius: 12px;
    max-width: 85%;
    margin-bottom: 25px;
    font-size: 16px;
    line-height: 22px;
    position: relative;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

/* SETA DA BOLHA */
.msg:after {
    content: "";
    position: absolute;
    left: -8px;
    top: 12px;
    width: 0;
    height: 0;
    border-top: 8px solid transparent;
    border-right: 10px solid #ffffff;
    border-bottom: 8px solid transparent;
}

/* Título da tarefa */
.msg-title {
    font-weight: 700;
    margin-bottom: 10px;
}

/* BOTÕES IGUAL WHATSAPP */
.btn-row {
    display: flex;
    flex-direction: column;
    margin-top: 12px;
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid #dcdcdc;
}

.btn-option {
    width: 100%;
    padding: 14px;
    font-size: 17px;
    display: flex;
    align-items: center;
    gap: 10px;
    border-bottom: 1px solid #dcdcdc;
    background: #fff;
    cursor: pointer;
}

.btn-option:last-child {
    border-bottom: none;
}

/* Ícones setas */
.icon {
    width: 22px;
    opacity: 0.6;
}

.btn-option.green {
    color: #0a7c2f;
}

/* OBSERVAÇÃO */
.obs-box {
    width: 100%;
    margin-top: 12px;
    padding: 10px;
    border-radius: 8px;
    font-size: 15px;
    border: 1px solid #ccc;
}

/* STATUS CHECKS */
.status {
    font-size: 12px;
    text-align: right;
    margin-top: 6px;
    opacity: 0.6;
}

.check-grey {
    color: #999;
}

.check-green {
    color: #0a7c2f;
}
</style>
</head>

<body>

<div class="header">Cozinha</div>

<div class="chat-area" id="tarefasBox"></div>

<script>
const SETOR_ATUAL = "Cozinha";
const API = "https://script.google.com/macros/s/AKfycbxWIbVy4Q6z36M4Y-wgegjzBjl2GkfORPehRPjFYCFVCPFirpl8OH73CLHZ85RCXQxvNg/exec";

/* BUSCAR TAREFAS */
async function carregarTarefas() {
    const resp = await fetch(`${API}?acao=listar&setor=${SETOR_ATUAL}`);
    const dados = await resp.json();
    const box = document.getElementById("tarefasBox");

    box.innerHTML = ""; // limpa sem piscar nada

    dados.forEach(t => {
        const chk = t.status === "Feita"
            ? `<div class="status check-green">✔✔ concluída</div>`
            : `<div class="status check-grey">✔✔ pendente</div>`;

        const item = document.createElement("div");
        item.className = "msg";

        item.innerHTML = `
            <div class="msg-title">${t.tarefa}</div>

            <textarea class="obs-box" id="obs-${t.id}" placeholder="Observações...">${t.observacao || ""}</textarea>

            <div class="btn-row">

                <div class="btn-option" onclick="marcar(${t.id})">
                    <img src="icons/arrow-grey.png" class="icon">
                    Sim
                </div>

                <div class="btn-option green" onclick="naoFazer()">
                    <img src="icons/arrow-green.png" class="icon">
                    Não
                </div>

            </div>

            ${chk}
        `;

        box.appendChild(item);
    });
}

/* MARCAR COMO FEITA */
async function marcar(id) {
    const obs = document.getElementById("obs-" + id).value;

    await fetch(API, {
        method: "POST",
        body: JSON.stringify({
            acao: "finalizar",
            id: id,
            observacao: obs
        })
    });

    carregarTarefas();
}

function naoFazer() {
    alert("Ok! Nada alterado.");
}

carregarTarefas();
</script>

</body>
</html>
